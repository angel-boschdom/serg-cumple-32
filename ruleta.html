<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sergio Cumple 30!</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(to bottom, #aa151b 33.33%, #f1bf00 33.33%, #f1bf00 66.66%, #aa151b 66.66%);
            /* Spanish flag background */
            text-align: center;
            position: relative;
        }

        canvas {
            border: 5px solid #333;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .controls input {
            margin: 5px;
            width: 300px;
            padding: 10px;
            font-size: 16px;
        }

        .controls button {
            margin: 5px;
            padding: 10px;
            font-size: 16px;
        }

        h1 {
            color: #FFFFFF;
            margin-bottom: 20px;
        }

        img {
            width: 150px;
            height: auto;
            border-radius: 50%;
            margin-bottom: 20px;
            border: 5px solid #333;
        }

        /* Home link (replaces burger menu) */
        .home-link {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: #8B0000; /* Dark red */
            color: #ffffff;
            padding: 10px 18px;
            border-radius: 999px;
            text-decoration: none;
            font-weight: bold;
            font-size: 16px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .home-link:hover {
            background-color: #a80000;
        }
    </style>
</head>
<body>
    <a class="home-link" href="./index.html">Home</a>

    <h1>Sergio Cumple 32!</h1>
    <img src="./assets/sergio.png" alt="Sergio">

    <canvas id="wheelCanvas" width="400" height="400"></canvas>

    <div class="controls">
        <input id="choicesInput" type="text" placeholder="Chupito!, Canción de Mariachi, ...">
        <button id="spinButton">Dale a la Ruleta!</button>
    </div>

    <script>
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const spinButton = document.getElementById('spinButton');
        const choicesInput = document.getElementById('choicesInput');

        let choices = ["Chupito!", "Perreo intenso", "Cantar canción", "Baile sexy", "Lo que diga Sergio", "Dar instagram", "Reto sorpresa", "Piquito con Ibético"];
        let startAngle = 0;
        let arc = Math.PI / (choices.length / 2);
        let spinTimeout = null;
        let spinAngleStart = 10;
        let spinTime = 0;
        let spinTimeTotal = 0;
        let isSpinning = false;
        let startX = 0;
        let startY = 0;
        let startTime = 0;

        function drawRouletteWheel() {
            arc = Math.PI / (choices.length / 2);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const outsideRadius = 200;
            const textRadius = 160;
            const insideRadius = 50;

            ctx.strokeStyle = "black";
            ctx.lineWidth = 2;

            ctx.font = 'bold 16px Arial';

            for (let i = 0; i < choices.length; i++) {
                const angle = startAngle + i * arc;
                ctx.fillStyle = getColor(i, choices.length);

                ctx.beginPath();
                ctx.arc(canvas.width / 2, canvas.height / 2, outsideRadius, angle, angle + arc, false);
                ctx.arc(canvas.width / 2, canvas.height / 2, insideRadius, angle + arc, angle, true);
                ctx.stroke();
                ctx.fill();

                ctx.save();
                ctx.fillStyle = "black";
                ctx.translate(
                    canvas.width / 2 + Math.cos(angle + arc / 2) * textRadius,
                    canvas.height / 2 + Math.sin(angle + arc / 2) * textRadius
                );
                ctx.rotate(angle + arc / 2 + Math.PI / 2);
                const text = choices[i];
                ctx.fillText(text, -ctx.measureText(text).width / 2, 0);
                ctx.restore();
            }

            // Arrow
            ctx.fillStyle = "black";
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2 - 4, canvas.height / 2 - (outsideRadius + 5));
            ctx.lineTo(canvas.width / 2 + 4, canvas.height / 2 - (outsideRadius + 5));
            ctx.lineTo(canvas.width / 2 + 4, canvas.height / 2 - (outsideRadius - 5));
            ctx.lineTo(canvas.width / 2 + 9, canvas.height / 2 - (outsideRadius - 5));
            ctx.lineTo(canvas.width / 2 + 0, canvas.height / 2 - (outsideRadius - 13));
            ctx.lineTo(canvas.width / 2 - 9, canvas.height / 2 - (outsideRadius - 5));
            ctx.lineTo(canvas.width / 2 - 4, canvas.height / 2 - (outsideRadius - 5));
            ctx.lineTo(canvas.width / 2 - 4, canvas.height / 2 - (outsideRadius + 5));
            ctx.fill();
        }

        function getColor(item, maxItem) {
            const colors = ["#E74C3C", "#F39C12", "#2ECC71", "#9B59B6", "#3498DB", "#1ABC9C", "#F1C40F", "#2ECC71"];
            return colors[item % colors.length];
        }

        function rotateWheel() {
            spinTime += 30;
            if (spinTime >= spinTimeTotal) {
                stopRotateWheel();
                return;
            }
            const spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
            startAngle += (spinAngle * Math.PI / 180);
            drawRouletteWheel();
            spinTimeout = setTimeout(rotateWheel, 30);
        }

        function stopRotateWheel() {
            clearTimeout(spinTimeout);
            isSpinning = false;

            // Calculate the angle where the arrow is pointing
            const degrees = startAngle * 180 / Math.PI + 90;
            const arcd = arc * 180 / Math.PI;
            let index = Math.floor((360 - degrees % 360) / arcd);

            if (index >= choices.length) {
                index = index % choices.length;
            }

            ctx.save();
            ctx.font = 'bold 30px Arial';
            const text = choices[index];
            ctx.fillText(text, canvas.width / 2 - ctx.measureText(text).width / 2, canvas.height / 2 + 10);
            ctx.restore();
        }

        function easeOut(t, b, c, d) {
            const ts = (t /= d) * t;
            const tc = ts * t;
            return b + c * (tc + -3 * ts + 3 * t);
        }

        canvas.addEventListener('touchstart', function (e) {
            if (isSpinning) return;
            const touch = e.touches[0];
            startX = touch.clientX;
            startY = touch.clientY;
            startTime = new Date().getTime();
        });

        canvas.addEventListener('touchend', function (e) {
            if (isSpinning) return;

            const touch = e.changedTouches[0];
            const endX = touch.clientX;
            const endY = touch.clientY;
            const endTime = new Date().getTime();

            const deltaX = endX - startX;
            const deltaY = endY - startY;
            const deltaTime = endTime - startTime;

            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            const minSpeed = 0.3;
            const speed = distance / deltaTime + minSpeed;

            spinAngleStart = Math.min(50, speed * 100);
            spinTime = 0;
            spinTimeTotal = Math.random() * 3000 + 4000;

            isSpinning = true;
            rotateWheel();
        });

        spinButton.addEventListener('click', () => {
            if (isSpinning) return;

            const userChoices = choicesInput.value
                .split(',')
                .map(choice => choice.trim())
                .filter(choice => choice !== '');

            if (userChoices.length > 1) {
                choices = userChoices;
            } else if (choicesInput.value.trim() === '') {
                choices = ["Chupito!", "Perreo intenso", "Cantar Viva España", "Baile sexy", "Lo que diga Sergio", "Dar instagram", "Reto sorpresa", "Piquito con Ibético"];
            } else {
                alert("Introduce al menos dos opciones.");
                return;
            }
            arc = Math.PI / (choices.length / 2);
            spinAngleStart = Math.random() * 10 + 10;
            spinTime = 0;
            spinTimeTotal = Math.random() * 3000 + 4000;

            isSpinning = true;
            rotateWheel();
        });

        drawRouletteWheel();
    </script>
</body>
</html>